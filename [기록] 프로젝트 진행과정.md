> ### 🏃🏻‍♀️ 참고
>
> 지속적으로 수정 및 추가중인 글입니다.

### 프로젝트를 시작하며

1. 여러 가지 사항을 정하기 전에 사용할 api를 확실히 정하고 시작해야 합니다.

   검색 결과 나온 많은 open API가 제공이 중지되었습니다. 

   [maniadb api](http://www.maniadb.com/api#ALBUM05)를 사용하기로 결정하였습니다.

2. 방향성 수정

   원래 인디 장르 음악을 중심으로 자체적으로 DB에 앨범 정보들을 왕창 저장하려고 했는데, 원하는 포맷대로 데이터를 긁어와서 다시 제 데이터베이스에 저장하는 것이 꽤나 번거롭고 복잡한 일이 될 것 같다고 생각했습니다. 그래서 앨범 정보 제공은 외부 API를 사용하고, 게시판 기능이나 다른 기능에 집중하기로 했습니다. 따라서 '인디 음악'이라는 색깔은 거의 없어졌다고 봐도 무방합니다. 🙄

   음악 정보 자체를 저장하고 보여주는 대신, 사이트 내의 검색어를 따로 저장하여 이 데이터를 활용해보기로 생각했습니다.

<br>

### 초면인 기술들 👋🏻 (학습 요망)

1. spring 내부에서 api를 호출하는 법
2. xml 형식의 데이터 파싱하고 원하는 데이터 추출
3. thymeleaf와 bootstrap의 연동 

<br>

### API 호출하고 결과 받아오기

사용하기로 한 [maniadb API v0.5](http://www.maniadb.com/api#ALBUM05)가 현재는 key 유효성 검사를 하지 않으므로 key 발급이 필요 없어서 빠르게 사용할 수 있었습니다. url에 파라미터만 넣어주고 GET 방식으로 요청하면 바로 결과를 받을 수 있었습니다.

두 가지 방식의 api를 제공하는데, 첫째로 음악 정보 검색 둘째로 앨범 정보입니다.

1. Search

   2개의 parameter를 바꾸어 넣어주었습니다.

   ```
   http://www.maniadb.com/api/search/[keyword]/?sr=[artist|album|song]&display=15&key=제 이메일&v=0.5
   ```

2. 앨범 정보 

   1개의 parameter를 바꾸어 넣어주었습니다.

   ```
   http://www.maniadb.com/api/album/[album_id]/?key=제 이메일
   ```

Api 호출 클래스를 생성하고, RestTemplate를 이용하여 요청 및 응답을 받았습니다.

```java
public class SearchApiClient {
    private final RestTemplate restTemplate;
    private final String SEARCH_URL_BASE = "http://www.maniadb.com/api/search/";
    private final String ALBUM_INFO_URL_BASE = "http://www.maniadb.com/api/album/";

    public String searchApi(String keyword, SearchCategory category){
        UriComponents uriBuilder = UriComponentsBuilder.fromHttpUrl(SEARCH_URL_BASE)
                .path(keyword + "/")
                .queryParam("sr", category.getParam())
                .queryParam("display", 16)
                .queryParam("key", "miinju.choi@gmail.com")
                .queryParam("v", 0.5)
                .build(false);

        final HttpHeaders headers = new HttpHeaders();
        final HttpEntity<String> entity = new HttpEntity<>(headers);

        return restTemplate.exchange(uriBuilder.toString(), HttpMethod.GET, entity, String.class).getBody();
    }

    public String getAlbumInfo(Long albumId){
        UriComponents uriBuilder = UriComponentsBuilder.fromHttpUrl(ALBUM_INFO_URL_BASE)
                .path(albumId + "/")
                .queryParam("key", "miinju.choi@gmail.com")
                .queryParam("v", 0.5)
                .build(false);

        final HttpHeaders headers = new HttpHeaders();
        final HttpEntity<String> entity = new HttpEntity<>(headers);

        return restTemplate.exchange(uriBuilder.toString(), HttpMethod.GET, entity, String.class).getBody();
    }

}
```

이제 여기서 받은 응답 XML 파일을 파싱하고 원하는 정보만 뽑아내야 합니다.